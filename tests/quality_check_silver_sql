/*
===============================================================================
Quality Checks
===============================================================================
Script Purpose:
    This script performs various quality checks for data consistency, accuracy, 
    and standardization across the 'silver' layer. It includes checks for:
    - Null or duplicate primary keys.
    - Unwanted spaces in string fields.
    - Data standardization and consistency.
    - Invalid date ranges and orders.
    - Data consistency between related fields.

Usage Notes:
    - Run these checks after data loading Silver Layer.
    - Investigate and resolve any discrepancies found during the checks.
===============================================================================
*/

-- ====================================================================
-- Checking 'silver.crm_cust_info'
-- ====================================================================
SELECT *
FROM bronze.crm_cust_info

- Quality Check; check that the Primary Key is unique and not null

SELECT
cst_id,
COUNT(*)
FROM silver.crm_cust_info
GROUP BY cst_id
HAVING COUNT(*) > 1 OR cst_id IS NULL;


--Check for unwanted speces in string values on cust_firstname, cst_lastname and cst_gndr
--Expectation: No Results

SELECT *
FROM silver.crm_cust_info
WHERE cst_lastname!= TRIM(cst_lastname)


--Data Standardization & Consistency
--Check the consistency of values in low cardinality columns

SELECT DISTINCT cst_gndr
FROM silver.crm_cust_info

SELECT * FROM silver.crm_cust_info

============================================================================
--Quality check on crm_prd_info
============================================================================
--Check for unwanted spaces
SELECT 
prd_nm
FROM silver.crm_prd_info
WHERE prd_nm != TRIM(prd_nm)

--Check for NULLS or negative numbers
--Expectation: No Results
SELECT
prd_cost
FROM silver.crm_prd_info
WHERE prd_cost<0 OR prd_cost IS NULL

--Data Standardization & Consistency
SELECT DISTINCT 
prd_line
FROM silver.crm_prd_info

--Check for Invalid Date Orders
SELECT *
FROM silver.crm_prd_info
WHERE prd_end_dt < prd_start_dt;

  SELECT* FROM silver.crm_prd_info


=============================================================================
--Quality check on sales details table
=============================================================================

  SELECT* FROM silver.crm_sales_details
============================================================================
  --Quality check on erp_cust_az12 table
=============================================================================
  --Identify Out-of- Range dates
  SELECT DISTINCT bdate
FROM silver.erp_cust_az12
WHERE bdate < '1924-01-01' OR bdate > GETDATE()

  SELECT DISTINCT gen
FROM silver.erp_cust_az12

SELECT* FROM silver.crm_sales_details
=============================================================================
--Quality check on erp_loc_a101 table
==============================================================================
SELECT
cid,
centry
FROM silver.erp_loc_a101
WHERE REPLACE (cid, '-', '') NOT IN (SELECT cst_key FROM silver.crm_cust_info)

--Data Standardization & Consistency
SELECT DISTINCT centry
FROM silver.erp_loc_a101

SELECT * FROM silver.erp_loc_a101
